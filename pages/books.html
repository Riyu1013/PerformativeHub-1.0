<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Books</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">

    <!-- Bootstrap JS -->
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="../styles.css">
    
</head>
<body>
  <nav class="navbar navbar-expand-lg bg-body" id="my-nav">
    <div class="container-fluid">
      <div class="brand-wrapper">
      <a class="navbar-brand" id="hero-text.shrink" href="index.html">Performative <br> Website</a>
      </div>
      <div class="nav-item" id="nav-item">
        <a class="justify-content-end fs-5" href="about.html">About, </a>
        <a class="justify-content-end fs-5" href="contact.html">Contact, </a>
        <a class="justify-content-end fs-5" href="" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight" aria-controls="offcanvasRight">Cart</a>
      </div>
    </div>
  </nav>
  <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="offcanvasRightLabel">Cart</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body" id="cart-items">

    </div>
  </div>
  <div class="row mt-5" id="books-container">
    <!-- Book Preview -->
    <div class="col-lg-4 d-flex flex-column align-items-center">
      <div class="d-flex flex-column w-50 mb-2">
        <button type="button" class="btn-close ms-auto visually-hidden" id="button-clear-preview" aria-label="Close"></button>
        <img class="img-fluid border rounded" id="cover">
      </div>

      <!-- Purchase Control -->
      <div class="w-50 text-center visually-hidden" id="book-purchase-control">
        <h4 class="mb-0" id="title">Title</h4>
        <p class="mb-0" id="author">By Author</p>
        <hr class="mx-auto my-2">
        <p class="mb-0" id="tag">Tag</p>
        <hr class="mx-auto my-2">
        <div class="d-flex align-items-center justify-content-evenly mb-3" id="purchase-popup-quantity-group">
          <div class="">Quantity</div>
          <p class="text-center fs-3 mb-0" id="purchase-quantity">1</p>
          <div class="d-grid gap-2 d-md-block">
            <button class="btn btn-secondary" type="button" id="decrease-button"> - </button>
            <button class="btn btn-secondary" type="button" id="increase-button"> + </button>
          </div>
        </div>
        <div class="d-flex justify-content-center">
          <button class="btn btn-primary" type="button" id="add-to-cart-btn">Add To Cart</button>
        </div>

      </div>
    </div>

    <!-- Books table -->
    <div class="col-lg-8" id="books-table-container">
      <h2>Books</h2>
      <table class="table table-hover" id="books-table">
        <thead>
          <tr>
            <th>Title</th>
            <th>Tag</th>
            <th>Author</th>
            <th>Year</th>
          </tr>
        </thead>
        <tbody class="table-group-divider" id="tbody-books"></tbody>
      </table>
    </div>
  </div>

  <footer id="footer">
    <div class="footer-brand">
      <h1>DON'T MISS NEW ITEMS</h1>

      <form class="w-100 m-0">
        <div class="row g-3">
          <div class="col-md-10">
            <input type="email" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="Enter your email">
          </div>
          <div class="col-md-2">
            <button type="submit" class="btn btn-primary">Go</button>
          </div>
        </div>
      </form>
    </div>
    <div class="footer-nav">
      <div class="footer-info">
        <h4>You Can Find Us</h4>
        <p>performative@gmail.com</p>
        <p>+12 345 6789</p>
        <p>Governor Pack Road, Baguio City, 2600, Benguet, Philippines</p>
      </div>
      <div class="footer-faq">
        <h4>We Will Always Help</h4>
        <p>Terms and Conditions</p>
        <p>Privacy Policy</p>
        <p>Cookies</p>
        <p>Shipping & Returns</p>
      </div>
    </div>
  </footer>
  <div class="cursor" id="cursor">
    <svg width="60" height="60">
      <circle cx="30" cy="30" r="20" stroke="black" stroke-width="1" fill="white"></circle>
    </svg>
  </div>   


  <script>
    // Add books here following the given format
    const BOOKS = [
      {
        "title": "Infinite Jest",
        "tag": "Philosophical Fiction",
        "author": "David Foster Wallace",
        "year": 1996,
        "coverFilename": "infinite-jest.jpg"
      },
      {
        "title": "The Stranger",
        "tag": "Existentialism",
        "author": "Albert Camus",
        "year": 1942,
        "coverFilename": "the-stranger.jpg"
      },
      {
        "title": "Thus Spoke Zarathustra",
        "tag": "Philosophy",
        "author": "Friedrich Nietzsche",
        "year": 1883,
        "coverFilename": "thus-spoke-zarathustra.jpg"
      },
      {
        "title": "Meditations",
        "tag": "Stoic Philosophy",
        "author": "Marcus Aurelius",
        "year": 2003,
        "coverFilename": "meditations.jpg"
      },
      {
        "title": "The Brothers Karamazov",
        "tag": "Classic Literature",
        "author": "Fyodor Dostoevsky",
        "year": 1880,
        "coverFilename": "the-brothers-karamazov.jpg"
      },
      {
        "title": "Blood Meridian",
        "tag": "Gritty Literature",
        "author": "Cormac McCarthy",
        "year": 1985,
        "coverFilename": "blood-meridian.jpg"
      },
      {
        "title": "The Road",
        "tag": "Post-Apocalyptic Fiction",
        "author": "Cormac McCarthy",
        "year": 2006,
        "coverFilename": "the-road.jpg"
      },
      {
        "title": "American Psycho",
        "tag": "Satire / Hyper-Masculine Critique",
        "author": "Bret Easton Ellis",
        "year": 1991,
        "coverFilename": "american-psycho.png"
      },
      {
        "title": "Fight Club",
        "tag": "Dark Satire",
        "author": "Chuck Palahniuk",
        "year": 1996,
        "coverFilename": ""
      },
      {
        "title": "The Old Man and the Sea",
        "tag": "Classic Masculinity",
        "author": "Ernest Hemingway",
        "year": 1952,
        "coverFilename": ""
      },
      {
        "title": "The 48 Laws of Power",
        "tag": "Self-Help / Strategy",
        "author": "Robert Greene",
        "year": 1998,
        "coverFilename": ""
      },
      {
        "title": "Atomic Habits",
        "tag": "Self-Improvement",
        "author": "James Clear",
        "year": 2018,
        "coverFilename": ""
      },
      {
        "title": "Can't Hurt Me",
        "tag": "Grit / Self-Help",
        "author": "David Goggins",
        "year": 2018,
        "coverFilename": ""
      },
      {
        "title": "The Art of War",
        "tag": "Strategy",
        "author": "Sun Tzu",
        "year": 1963,
        "coverFilename": ""
      },
      {
        "title": "Sapiens",
        "tag": "Pop Nonfiction / Anthropology Flex",
        "author": "Yuval Noah Harari",
        "year": 2014,
        "coverFilename": ""
      },
      {
        "title": "Zero to One",
        "tag": "Startup / Business",
        "author": "Peter Thiel",
        "year": 2014,
        "coverFilename": ""
      },
      {
        "title": "GÃ¶del, Escher, Bach",
        "tag": "Intellectual Flex / Math-Philosophy",
        "author": "Douglas Hofstadter",
        "year": 1979,
        "coverFilename": ""
      },
      {
        "title": "1984",
        "tag": "Classic Dystopia",
        "author": "George Orwell",
        "year": 1949,
        "coverFilename": ""
      },
      {
        "title": "On the Road",
        "tag": "Beat Literature",
        "author": "Jack Kerouac",
        "year": 1957,
        "coverFilename": ""
      },
      {
        "title": "Slaughterhouse-Five",
        "tag": "Anti-War Literature",
        "author": "Kurt Vonnegut",
        "year": 1969,
        "coverFilename": ""
      }
    ];

    // ========== Books Table ========== //
    const tbody = document.getElementById("tbody-books");

    // Populate the table body
    for (let i = 0; i < BOOKS.length; i++) {
      const row = document.createElement("tr");

      const title = document.createElement("td");
      title.textContent = BOOKS[i].title;

      const tag = document.createElement("td");
      tag.textContent = BOOKS[i].tag;

      const author = document.createElement("td");
      author.textContent = BOOKS[i].author;

      const year = document.createElement("td");
      year.textContent = BOOKS[i].year;

      row.dataset.title = BOOKS[i].title;
      row.dataset.tag = BOOKS[i].tag;
      row.dataset.author = BOOKS[i].author;
      row.dataset.src = "../media/books/" + BOOKS[i].coverFilename;
      row.dataset.alt = "Book cover of " + BOOKS[i].title;
      row.dataset.id = "book-" + i; 
      row.appendChild(title);
      row.appendChild(tag);
      row.appendChild(author);
      row.appendChild(year);

      tbody.appendChild(row);
    }
    
    let hasBookSelected = false;
    let currentActiveRow = null;

    // Get the rows of the table
    const table = document.getElementById("books-table");
    const rows = table.querySelectorAll("tbody tr");

    const purchaseControl = document.getElementById("book-purchase-control");
    const clearPreviewButton = document.getElementById("button-clear-preview");

    function updateBookPreview(row) {
      const cover = document.getElementById("cover");
      cover.src = row.dataset.src;
      cover.alt = row.dataset.alt;

      document.getElementById("title").innerHTML = row.dataset.title;
      document.getElementById("tag").innerHTML = row.dataset.tag;
      document.getElementById("author").innerHTML = row.dataset.author;
    }

    // Mouse hover updates the book preview
    rows.forEach(row => {
      row.addEventListener("mouseenter", () => {
        if (!hasBookSelected) updateBookPreview(row);
      });

      // Set active a table row
      row.addEventListener("click", () => {
        if (currentActiveRow) {
          currentActiveRow.classList.remove("table-active");
        }

        row.classList.add("table-active");
        currentActiveRow = row;
        hasBookSelected = true;

        purchaseControl.classList.remove("visually-hidden");
        clearPreviewButton.classList.remove("visually-hidden");

        updateBookPreview(row);
        setPurchaseAmount(MIN_PURCHASE_AMOUNT);
      });
    });

    clearPreviewButton.addEventListener("click", () => {
      hasBookSelected = false;
      currentActiveRow.classList.remove("table-active");
      purchaseControl.classList.add("visually-hidden");
      clearPreviewButton.classList.add("visually-hidden");
      setPurchaseAmount(MIN_PURCHASE_AMOUNT);
    });

    // ========== Purchase Control ========== //
    const MIN_PURCHASE_AMOUNT = 1;
    const MAX_PURCHASE_AMOUNT = 10;
    const PURCHASE_AMOUNT_ID = "purchase-quantity";


    function getPurchaseAmount() {
        return document.getElementById(PURCHASE_AMOUNT_ID).innerHTML;
    }

    function setPurchaseAmount(value) {
        document.getElementById(PURCHASE_AMOUNT_ID).innerHTML = value;
    }

    function updatePurchaseAmountBy(value) {
        let purchaseAmount = parseInt(getPurchaseAmount());
        purchaseAmount += value;
        // Clamp the purchase amount
        purchaseAmount = Math.min(Math.max(purchaseAmount, MIN_PURCHASE_AMOUNT), MAX_PURCHASE_AMOUNT);
        setPurchaseAmount(purchaseAmount);
    }

    function onClickHandler(value) {
        updatePurchaseAmountBy(value);
    }

    document.getElementById("decrease-button").addEventListener("click", (e) => {onClickHandler(-1)});
    document.getElementById("increase-button").addEventListener("click", (e) => {onClickHandler(1)});

    // Add to cart functionality
    const cart = JSON.parse(sessionStorage.getItem("cart")) || [];
    document.getElementById("add-to-cart-btn").addEventListener("click", () => {
    // Get current product info from popup
    const product = {
      title: document.getElementById("title").textContent,
      image: document.getElementById("cover").src,
      quantity: parseInt(getPurchaseAmount())
    };

    // Check if already in cart by title (or id)
    const existingIndex = cart.findIndex(item => item.title === product.title);
    if (existingIndex >= 0) {
      cart[existingIndex].quantity += product.quantity;
    } else {
      cart.push(product);
    }

    // Save back to sessionStorage
    sessionStorage.setItem("cart", JSON.stringify(cart));
    alert(`${product.title} added to cart!`);

    // Optionally close popup
    main.classList.remove("blur");
    popup.classList.add("hidden");
    isPurchasePopupVisible = false;
    });
  </script>
  
<!-- Global JS -->
<script defer src="../script/main.js"></script>
</body>
</html>