<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <!-- Bootstrap JS -->
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>

    <!-- Bootstrap ICONS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

    <link rel="stylesheet" href="../styles.css">
    <title>Music Page</title>
</head>
<body>

<nav class="navbar navbar-expand-lg bg-body" id="my-nav">
  <div class="container-fluid">
    <div class="brand-wrapper">
      <a class="navbar-brand" id="hero-text.shrink" href="../index.html">Performative <br> Website</a>
    </div>
    <div class="nav-item">
      <a class="justify-content-end fs-5" href="about.html">About, </a>
      <a class="justify-content-end fs-5" href="contact.html">Contact, </a>
      <a class="justify-content-end fs-5" href="">Cart</a>
    </div>
  </div>
</nav>

<div class="music-body">
  <div id="song-list">
    <table class="table table-hover caption-top">
      <caption>Songs</caption>
      <thead>
        <tr><td>Title</td><td>Artist</td></tr>
      </thead>
      <tbody class="table-group-divider" id="tbody-songs"></tbody>
    </table>
  </div>

  <div id="vinyl-container">
      <img src="../media/songs/black-vinyl-record-with-red-label-illustration-png.png" alt="Vinyl Record" id="vinyl-record">
  </div>
  <input type="range" min="0" max="1" step="0.01" id="volume">

</div>

<audio id="audio-player"></audio>

<footer id="footer">
  <div class="footer-brand">
    <h1>DON'T MISS NEW ITEMS</h1>
    <form class="w-100 m-0">
    <div class="row g-3">
      <div class="col-md-10">
      <input type="email" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="Enter your email">
      </div>
      <div class="col-md-2">
      <button type="submit" class="btn btn-primary">Go</button>
      </div>
    </div>
    </form>
  </div>
  <div class="footer-nav">
    <div class="footer-info">
    <h4>You Can Find Us</h4>
    <p>performative@gmail.com</p>
    <p>+12 345 6789</p>
    <p>Governor Pack Road, Baguio City, 2600, Benguet, Philippines</p>
    </div>
    <div class="footer-faq">
    <h4>We Will Always Help</h4>
    <p>Terms and Conditions</p>
    <p>Privacy Policy</p>
    <p>Cookies</p>
    <p>Shipping & Returns</p>
    </div>
  </div>
</footer>

<div class="cursor" id="cursor">
  <svg width="60" height="60">
    <circle cx="30" cy="30" r="20" stroke="black" stroke-width="1" fill="white"></circle>
  </svg>
</div>

<!-- Global JS -->
<script defer src="../script/main.js"></script>
<!-- MUSIC -->
<script src="../script/data-music.js"></script>
<script>
  // Populate the music table
  const tbody = document.getElementById("tbody-songs");

  // Populate the table body
  for (let i = 0; i < SONGS.length; i++) {
    const song = SONGS[i];

    const row = document.createElement("tr");

    const title = document.createElement("td");
    title.textContent = song.title;

    const artist = document.createElement("td");
    artist.textContent = song.artist;

    row.dataset.title = song.title;
    row.dataset.artist = song.artist;
    row.dataset.coverSrc = "../media/songs/covers/" + song.coverFilename;
    row.dataset.audioSrc = "../media/songs/audio/" + song.audioFilename;
    row.dataset.id = "song-" + i;
    row.appendChild(title);
    row.appendChild(artist);

    tbody.appendChild(row);
  }

  const vinylContainer = document.getElementById('vinyl-container');
  const audioPlayer = document.getElementById('audio-player');

  // IMPORTANT!
  audioPlayer.volume = 0.5;

  const cover = document.createElement("img");
  cover.id = "album-cover-img";
  cover.classList.add("album-cover");
  vinylContainer.appendChild(cover);

  // function updateVinylCover() {

  // }

  
  tbody.addEventListener("click", (e) => {
    const clickedRow = e.target.closest('tr');
    
    if (clickedRow) {
      const albumCover = clickedRow.dataset.coverSrc; 
      const audioSrc = clickedRow.dataset.audioSrc;     

      // 2. Stop current playback and reset state
      audioPlayer.pause();
      audioPlayer.currentTime = 0;

      // 3. Execution Sequence 
      
      // Put the album cover on top of the vinyl
      cover.src = clickedRow.dataset.coverSrc;
      
      // Start the song playing
      audioPlayer.src = audioSrc;

      const slider = document.getElementById("volume");

      slider.addEventListener("input", () => {
        audioPlayer.volume = slider.value;
      });
      
      setTimeout(() => {
        vinylContainer.classList.add('is-playing'); // This starts the CSS animation and fades in the cover
        
        audioPlayer.play()
          .then(() => {
              console.log(`Now playing: ${clickedRow.firstElementChild.textContent}`);
          })
          .catch(error => {
              console.error("Audio playback failed.", error);
        });
      }, 100); 
    }
  });
</script>
</body>
</html>